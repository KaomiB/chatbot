"""
HSA chatbot content: 23 topic nodes from QA_ARCHITECTURE_FROM_KB.md.
Generated by scripts/build_content_from_architecture.py — re-run that script after editing the architecture doc.
"""
from __future__ import annotations
from dataclasses import dataclass
from typing import Optional

@dataclass
class Topic:
    id: str
    label: str
    answer: str
    citations: list[str]
    suggested_questions: list[str]
    next_suggested_topics: list[str]

TOPICS: list[Topic] = [
    Topic(
        id="what_is_hsa",
        label='What is a Health Savings Account?',
        answer='A Health Savings Account (HSA) is a special savings account where you\nset money aside — before taxes — to pay for healthcare expenses. The\nsimplest way to think about it: it\'s like a 401(k), but for healthcare\ninstead of retirement.\n\nYou and your employer can both contribute to your HSA, and you use\nthose funds tax-free to pay for a wide range of qualified medical\nexpenses — doctor visits, prescriptions, dental work, vision care,\nmental health therapy, and much more. You decide what to spend, what\nto save, and how to invest it.\n\nThe biggest thing that separates an HSA from other health accounts:\nthe money never expires. There is no "use it or lose it" rule. Your\nbalance rolls over every single year and keeps growing — whether you\nneed it next month or in retirement decades from now.',
        citations=['HealthEquity HSA Guidebook, p. 25', 'HSAs For Dummies, Optum Financial Special Edition, Introduction, p. 1', 'WageWorks Guide to HSAs, p. 8'],
        suggested_questions=['What is an HSA?', "What's an HSA?", 'Explain HSA to me', 'What does HSA stand for?', "I've never heard of an HSA", 'What is a health savings account?'],
        next_suggested_topics=['triple_tax', 'eligibility', 'portability'],
    ),
    Topic(
        id="triple_tax",
        label='What is the triple tax advantage?',
        answer='**Save more on taxes.** The HSA\'s "triple tax advantage" is what makes it the most powerful\nsavings vehicle in the U.S. tax code. No other account gives you all\nthree of these benefits at once.\n\nBenefit 1 — Contributions go in tax-free. Whether you, your employer,\nor a family member contributes, you pay no federal income tax on those\ndollars. If contributions come through payroll, you also skip Social\nSecurity and Medicare taxes (FICA) — a bonus that 401(k)s do not\noffer. For someone in the 22% tax bracket, the effective savings on\na payroll HSA contribution can exceed 30%.\n\nBenefit 2 — Your money grows tax-free. Any interest or investment\nearnings in your HSA accumulate without being taxed year by year, as\nlong as you use the money for qualified medical expenses.\n\nBenefit 3 — Withdrawals are tax-free. When you spend HSA funds on\nqualified medical expenses, you owe zero federal tax — at any age,\nat any time.\n\nOnly 6% of working Americans aged 18 to 34 can correctly identify all\nthree of these benefits. Knowing this puts you well ahead of your peers.',
        citations=['HealthEquity HSA Guidebook, Introduction, p. 5', 'HealthEquity HSA Guidebook, pp. 25–26', 'WageWorks Guide to HSAs, p. 15', 'Generational HSA Divide research document'],
        suggested_questions=['What is the triple tax advantage?', 'How does an HSA save me money on taxes?', 'Is an HSA tax-free?', 'What are the tax benefits of an HSA?', 'Why is an HSA better than other accounts?', 'How do HSA taxes work?'],
        next_suggested_topics=['eligibility', 'contribution_limits', 'hsa_vs_other'],
    ),
    Topic(
        id="eligibility",
        label='Am I eligible?',
        answer="To be eligible to open and contribute to an HSA, three main IRS rules\napply.\n\nRule 1: You must be enrolled in an HSA-qualified health plan —\ncommonly called a High-Deductible Health Plan (HDHP). These plans\ngenerally have lower monthly premiums but higher deductibles. They can\nbe employer-sponsored or purchased through an ACA exchange (bronze and\ncatastrophic level plans often qualify).\n\nRule 2: You cannot have certain other coverage. Specifically, you\ncannot have a standard Health FSA through your employer, be enrolled\nin Medicare, or be claimed as a dependent on someone else's tax return\nfor HSA contribution purposes.\n\nRule 3: No other disqualifying health coverage. If you have access to\na spouse's plan or supplemental coverage that pays expenses before\nyour HDHP deductible is met, that may disqualify you — check with\nyour HR or plan provider.\n\nIf you are currently on a parent's plan, whether you can open an HSA\ndepends on whether that specific plan is HSA-qualified. Once you are\nno longer eligible, you stop contributing — but all existing funds\nremain yours to use on qualified expenses indefinitely.",
        citations=['HealthEquity HSA Guidebook, pp. 6–7', 'WageWorks Guide to HSAs, p. 8'],
        suggested_questions=['Am I eligible for an HSA?', 'Who can open an HSA?', 'Can I have an HSA?', 'Do I qualify for an HSA?', 'What do I need to open an HSA?', "Can I get an HSA on my parent's plan?"],
        next_suggested_topics=['hdhp_basics', 'contribution_limits', 'misconceptions'],
    ),
    Topic(
        id="hdhp_basics",
        label='What is an HDHP?',
        answer='An HSA-qualified health plan — often called a High-Deductible Health\nPlan (HDHP) — is insurance that typically comes with lower monthly\npremiums than traditional plans, but a higher deductible (the amount\nyou pay out-of-pocket before insurance starts covering costs).\n\nThe government sets specific minimum deductible thresholds and maximum\nout-of-pocket limits that a plan must meet to be HSA-eligible. These\nnumbers adjust slightly each year. Your HR department or insurance\nprovider can confirm whether your specific plan qualifies.\n\nA common worry is losing your doctor. In most cases, HSA-qualified\nplans use the same healthcare networks as traditional coverage.\nWhether you stay in-network or use an out-of-network provider, you\ncan pay whatever you owe directly from your HSA.\n\nChoosing an HSA-qualified plan may change how you think about\nhealthcare spending — but it does not mean compromising the quality\nof care you receive.',
        citations=['HealthEquity HSA Guidebook, pp. 6, 8', 'WageWorks Guide to HSAs, p. 15'],
        suggested_questions=['What is a high-deductible health plan?', 'What is an HDHP?', 'What kind of health plan do I need for an HSA?', 'Does my health plan qualify for an HSA?', "What's the difference between an HDHP and regular insurance?"],
        next_suggested_topics=['eligibility', 'contribution_limits', 'qualified_expenses'],
    ),
    Topic(
        id="qualified_expenses",
        label='What can I spend it on?',
        answer="HSA funds can be used for a very wide range of qualified medical\nexpenses — far more than most people realize. The IRS defines a\nqualified medical expense as money paid primarily to prevent or treat\na physical or mental illness.\n\nQualified expenses include: doctor and specialist visits, copays and\ncoinsurance, hospital stays, prescription drugs, dental care, vision\ncare, mental health therapy, hearing aids, and many over-the-counter\n(OTC) products and medications. You can also use HSA funds for your\nspouse and tax dependents, even if they are not on your health plan.\n\nItems that do NOT qualify include general wellness purchases like\nvitamins (unless prescribed for a specific diagnosed condition), gym\nmemberships, or cosmetic-only procedures like teeth whitening.\n\nExplore the sub-topics below to learn what's covered in specific\ncategories.",
        citations=['HSAs For Dummies, Optum Financial Special Edition, p. 24', 'HealthEquity HSA Guidebook, p. 183', 'WageWorks Guide to HSAs, p. 67', 'HSAs For Dummies, Optum Financial Special Edition, p. 27'],
        suggested_questions=['What can I use my HSA for?', 'What are qualified medical expenses?', 'What can I spend HSA money on?', 'Can I use my HSA for prescriptions?', 'What counts as a medical expense for HSA?', 'Can I use my HSA for dental?'],
        next_suggested_topics=['qualified_expenses_mental_health', 'qualified_expenses_dental_vision', 'qualified_expenses_otc', 'qualified_expenses_premiums', 'qualified_expenses_family'],
    ),
    Topic(
        id="qualified_expenses_mental_health",
        label='Mental health & therapy',
        answer="Yes — mental health services are qualified medical expenses. Therapy\nsessions, psychiatric care, counseling, and prescription medications\nfor mental health conditions can all be paid with HSA funds tax-free.\n\nThis is a point many young adults miss. Gen Z and Millennials report\nhigh utilization of behavioral and mental health services — yet 46%\nof Gen Z respondents in one study said they would cut mental health\nspending first if their budget tightened. Using an HSA to cover these\ncosts means you're paying with pre-tax dollars, effectively getting\na 22–30% discount (depending on your tax bracket) on care you may\nalready be accessing.\n\nWhen younger adults understand that HSAs cover mental health therapy\nalongside physical healthcare, their engagement with HSAs increases\nsignificantly.",
        citations=['HSAs For Dummies, Optum Financial Special Edition, p. 24', 'Generational HSA Divide research document'],
        suggested_questions=['Can I use my HSA for therapy?', 'Does HSA cover mental health?', 'Can I pay for counseling with my HSA?', 'Is therapy an eligible HSA expense?', 'Can I use my HSA for a psychiatrist?'],
        next_suggested_topics=['qualified_expenses_otc', 'triple_tax', 'young_adults'],
    ),
    Topic(
        id="qualified_expenses_dental_vision",
        label='Dental & vision',
        answer='Both dental and vision care are covered HSA expenses — which catches\nmany people by surprise, since most health insurance plans do not\ncover them.\n\nDental: Checkups, cleanings, fillings, extractions, braces,\northodontia, implants, and dentures are all qualified. The exception:\npurely cosmetic procedures like teeth whitening are not eligible.\n\nVision: Eye exams, prescription glasses (including frames and\nlenses), contact lenses, contact lens solution, prescription\nsunglasses, and laser eye surgery (such as LASIK or PRK) are all\neligible. OTC reading glasses count too.\n\nSince dental and vision costs are often predictable, some people pair\na Limited Purpose FSA (LPFSA) alongside their HSA specifically to\ncover these expenses — allowing HSA funds to stay invested and\ngrowing for larger future needs.',
        citations=['WageWorks Guide to HSAs, p. 67', 'HSAs For Dummies, Optum Financial Special Edition, p. 27', 'HealthEquity HSA Guidebook, p. 53'],
        suggested_questions=['Can I use my HSA for dental?', 'Does HSA cover glasses or contacts?', 'Can I pay for LASIK with my HSA?', 'Is orthodontia covered by HSA?', 'Can HSA pay for an eye exam?'],
        next_suggested_topics=['qualified_expenses_otc', 'qualified_expenses_premiums', 'complementary_accounts'],
    ),
    Topic(
        id="qualified_expenses_otc",
        label='OTC products & prescriptions',
        answer='Since 2020, a wide range of over-the-counter (OTC) medications and\nproducts became HSA-eligible without needing a prescription — thanks\nto the CARES Act.\n\nEligible OTC items include: allergy medications, pain relievers (like\nTylenol and Advil), cold and flu treatments, cough syrup, sleep aids,\nstomach remedies, anti-fungal and anti-itch treatments, first-aid\nsupplies (bandages, hydrogen peroxide, alcohol wipes), contact lens\nsolution, sunscreen with SPF 15 or above, and menstrual care products\n(pads, tampons, cups, liners, etc.).\n\nPrescription drugs also qualify — generic or brand-name. If you take\nan expensive medication, ask about generic alternatives or check\nwhether the manufacturer offers a discount program.\n\nNote: General toiletries like soap and shampoo do not qualify. Vitamins\nare only eligible if specifically prescribed to treat a diagnosed\ncondition (and a letter of medical necessity from your provider may\nbe required).',
        citations=['HealthEquity HSA Guidebook, p. 101', 'HSAs For Dummies, Optum Financial Special Edition, pp. 25–26'],
        suggested_questions=['Can I buy OTC medicine with my HSA?', 'Does HSA cover Tylenol or Advil?', 'Can I use my HSA for sunscreen?', 'What over-the-counter items are HSA eligible?', 'Are menstrual products covered by an HSA?', 'Can I buy bandages with my HSA?'],
        next_suggested_topics=['qualified_expenses_dental_vision', 'recordkeeping'],
    ),
    Topic(
        id="qualified_expenses_premiums",
        label='Insurance premiums (exceptions)',
        answer="Generally, you cannot use HSA funds to pay health insurance premiums.\nBut there are important exceptions that can be a real lifeline.\n\nPremiums you CAN pay with your HSA:\n- COBRA continuation coverage after leaving a job\n- Health coverage while receiving federal or state unemployment\n  compensation\n- Qualified long-term care insurance (subject to age-based IRS limits)\n- Medicare Parts A, B, C, and D premiums — but only once you turn 65\n- Retiree health plan premiums (but NOT Medigap/Medicare supplement\n  policies)\n\nIf you lose your job, your HSA can cover COBRA premiums tax-free\nwhile you figure out your next coverage step. This safety net is\nsomething most young adults don't know exists until they need it.",
        citations=['HealthEquity HSA Guidebook, pp. 183–184', 'HSAs For Dummies, Optum Financial Special Edition, p. 26', 'WageWorks Guide to HSAs, p. 67'],
        suggested_questions=['Can I use my HSA to pay insurance premiums?', 'Can I pay COBRA with my HSA?', 'Can my HSA pay for Medicare premiums?', 'Can I pay for long-term care with my HSA?', 'What insurance can I pay with my HSA?'],
        next_suggested_topics=['age_65_medicare', 'portability', 'qualified_expenses'],
    ),
    Topic(
        id="qualified_expenses_family",
        label='Paying for family members',
        answer="Yes — you can use your HSA to pay qualified medical expenses for your\nspouse and any tax dependents, even if they are not enrolled in your\nHSA-qualified health plan.\n\nA dependent is generally someone you can claim on your tax return:\nchildren, stepchildren, and in some cases other qualifying relatives.\nIn divorce situations, either parent can use their own HSA to pay a\nchild's qualified expenses — even if only one parent claims the child\nas a tax dependent.\n\nThe same rules that define eligible expenses for you apply equally\nto your covered family members. You get the same tax-free benefit\nregardless of whose name is on the medical bill.",
        citations=['HSAs For Dummies, Optum Financial Special Edition, p. 27'],
        suggested_questions=['Can I use my HSA for my spouse?', 'Can I use my HSA for my kids?', "Can I pay for my family's medical bills with my HSA?", 'Does HSA cover dependents?', "Can I use HSA for my partner's expenses?"],
        next_suggested_topics=['contribution_limits', 'qualified_expenses'],
    ),
    Topic(
        id="contribution_limits",
        label='Contribution limits',
        answer='The IRS sets annual limits on how much can go into your HSA — from\nall sources combined (you, your employer, family members, anyone).\nThese limits adjust each year based on inflation.\n\nFor 2025, the limits are:\n- Self-only coverage: \$4,300\n- Family coverage: \$8,750\n- Catch-up contribution if you are 55 or older: an extra \$1,000\n\nNo matter who contributes, the combined total from all sources cannot\nexceed the annual limit. Only your own contributions and your\nemployer\'s contributions receive the direct tax benefit at the time\nof contribution. Contributions from others (like family members) can\nbe claimed as an above-the-line deduction on your tax return.\n\nIf you exceed the limit — even because of an employer contribution —\nyou will owe a 6% excise tax on the excess. If you open your HSA\nmid-year, you can still contribute the full year\'s maximum using the\n"last-month rule," but you must remain eligible through the end of\nthe following year or face taxes and a 10% penalty on any overage.',
        citations=['HealthEquity HSA Guidebook, p. 38', 'HealthEquity HSA Guidebook, pp. 77–79, 96', 'HSAs For Dummies, Optum Financial Special Edition, p. 13'],
        suggested_questions=['How much can I put in my HSA?', 'What are the HSA contribution limits?', 'Is there a max for HSA contributions?', 'How much can I contribute to an HSA per year?', 'Can my employer also contribute to my HSA?', 'What happens if I contribute too much to my HSA?'],
        next_suggested_topics=['funding_strategy', 'investment', 'triple_tax'],
    ),
    Topic(
        id="investment",
        label='Investing my HSA',
        answer='Yes — and this is the most underused HSA feature. You can invest your\nHSA balance in stocks, bonds, mutual funds, and certificates of\ndeposit, similar to an IRA or 401(k). Your investment earnings grow\nentirely tax-free.\n\nMost HSA administrators allow investing once your cash balance reaches\na minimum threshold — typically \$1,000 to \$2,000. Any amount above\nthat threshold can be moved into investment options. If you need funds\nfor a medical expense, you can move money back to cash at any time\nwith no tax penalty.\n\nThe math is compelling: saving \$3,000 per year for 30 years without\ninvesting accumulates to about \$90,000. Invested at a 7% average\nannual return, that same \$3,000 per year grows to approximately\n\$306,000 — over \$200,000 more, all tax-free for qualified expenses.\n\nDespite this potential, only 9–15% of HSA holders invest their funds;\nmost accounts sit in cash. If you can afford to pay current medical\nexpenses out of pocket, letting your HSA balance grow invested is one\nof the most powerful financial moves available to young adults.',
        citations=['HealthEquity HSA Guidebook, pp. 66, 127–129', 'HSAs For Dummies, Optum Financial Special Edition, p. 20', 'WageWorks Guide to HSAs, p. 64', 'Behavioral Architecture of Financial Avoidance research document'],
        suggested_questions=['Can I invest my HSA?', 'How do I invest my HSA money?', 'Does my HSA earn interest?', 'Can my HSA grow like a retirement account?', 'What investment options does an HSA have?', 'Should I invest my HSA?'],
        next_suggested_topics=['hsa_vs_other', 'funding_strategy', 'retirement_planning'],
    ),
    Topic(
        id="hsa_vs_other",
        label='HSA vs 401(k), FSA & IRA',
        answer='The HSA is the only account in the U.S. that combines all three tax\nbenefits: tax-free contributions, tax-free growth, and tax-free\nwithdrawals for qualified expenses. Every other account offers only\none or two of those.\n\nHSA vs 401(k): Both allow pre-tax contributions. But 401(k)\nwithdrawals are taxed as income in retirement. HSA withdrawals for\nqualified medical expenses are never taxed. Additionally, HSA\npayroll contributions skip FICA taxes (Social Security and Medicare)\n— a benefit 401(k) contributions do not get.\n\nHSA vs Traditional IRA: IRAs reduce your taxable income now but are\ntaxed on withdrawal. HSA withdrawals for qualified expenses are tax-\nfree at any time. High earners may also lose IRA deductibility above\ncertain income thresholds — HSAs have no income limit.\n\nHSA vs FSA: The FSA\'s critical drawback is the "use it or lose it"\nrule — unspent FSA funds generally expire at year-end. HSA funds\nroll over indefinitely. Confusing these two accounts is one of the\nmost common barriers to HSA adoption among young adults.',
        citations=['HealthEquity HSA Guidebook, pp. 5–6, 29', 'WageWorks Guide to HSAs, p. 15', 'Behavioral Architecture of Financial Avoidance research document'],
        suggested_questions=['How is an HSA different from a 401k?', "What's the difference between HSA and FSA?", 'HSA vs FSA — which is better?', 'How does an HSA compare to an IRA?', 'Is an HSA better than a 401k?', 'Should I choose an HSA or an FSA?'],
        next_suggested_topics=['triple_tax', 'complementary_accounts', 'misconceptions'],
    ),
    Topic(
        id="portability",
        label="It's yours — forever",
        answer='Your HSA belongs to you — not your employer, not your insurance\ncompany. It stays with you when you change jobs, change health plans,\nmove, or get married. Think of it the same way as a 401(k): it\'s\nyours.\n\nYour HSA balance rolls over automatically every year. There is no\ndeadline and no "use it or lose it" pressure. If you don\'t spend the\nmoney this year, it stays in your account and keeps growing.\n\nIf you lose HSA eligibility — for example, by switching to a\nnon-qualifying health plan — you stop being able to make new\ncontributions. But every dollar already in the account remains yours,\nand you can keep spending it on qualified medical expenses for as\nlong as you need.\n\nWhen you pass away, your HSA becomes part of your estate. If your\nspouse is your named beneficiary, they can inherit the account as\ntheir own HSA — tax-free.',
        citations=['HealthEquity HSA Guidebook, p. 6', 'HSAs For Dummies, Optum Financial Special Edition, p. 42', 'WageWorks Guide to HSAs, p. 75'],
        suggested_questions=['What happens to my HSA if I change jobs?', 'Do I lose my HSA if I leave my employer?', 'Is my HSA portable?', 'Who owns my HSA?', "What happens to HSA money I don't use?", 'Does my HSA expire?'],
        next_suggested_topics=['investment', 'age_65_medicare', 'what_is_hsa'],
    ),
    Topic(
        id="funding_strategy",
        label='How should I fund my HSA?',
        answer="A good starting rule: always contribute at least enough to capture any\nemployer match or employer contribution your plan offers. That is free\nmoney — do not leave it on the table.\n\nAfter capturing your employer's contribution, consider contributing up\nto the full IRS annual maximum. Because HSAs offer more tax advantages\nthan 401(k)s — including the FICA exemption on payroll contributions\n— many financial planners suggest maxing your HSA before adding extra\nto a 401(k) beyond any employer match.\n\nIf your budget allows, consider paying current medical expenses out\nof pocket and letting your entire HSA balance grow invested. You can\nreimburse yourself for old expenses at any time — even years later —\nas long as the expense occurred after your HSA was opened. This\nstrategy maximizes your invested balance and compounds your tax-free\ngrowth.\n\nIf money is tight, even small regular contributions add up. HSA funds\nnever expire, and every pre-tax dollar saved reduces your tax bill\nnow and grows your balance for later.",
        citations=['HealthEquity HSA Guidebook, pp. 118–119', 'HealthEquity HSA Guidebook, p. 49'],
        suggested_questions=['How should I contribute to my HSA?', 'Should I max out my HSA?', 'How do I get the most from my HSA?', 'Should I contribute to my HSA or 401k first?', 'How much should I put in my HSA?', 'My employer contributes to my HSA — what should I do?'],
        next_suggested_topics=['investment', 'contribution_limits', 'complementary_accounts'],
    ),
    Topic(
        id="young_adults",
        label='Why does this matter for me?',
        answer='The "I\'m healthy, I don\'t need this" mindset is the most common reason\nyoung adults miss out on one of the best financial tools available to\nthem. Research confirms it: only 6% of working Americans aged 18 to\n34 can correctly describe all three HSA tax benefits.\n\nHere\'s the reframe: being young is actually the best time to open an\nHSA. If you rarely need healthcare, your money just stays in the\naccount and grows — potentially for decades, entirely tax-free. The\nless you spend now, the more you accumulate for later.\n\nAnd young adults use healthcare more than the "invincible" image\nsuggests. Gen Z and Millennials are among the highest users of mental\nhealth and behavioral health services. HSAs cover therapy,\nprescriptions, and many other expenses you might already be paying\nfor out of pocket.\n\nThe most common moment young adults realize HSA value is when they\nage off a parent\'s health plan at 26 — or face a surprise medical\nbill. Starting before either of those moments means you\'ll have a\nfunded account ready when you actually need it.',
        citations=['Generational HSA Divide research document', 'Behavioral Architecture of Financial Avoidance research document', 'HSA Bank Health and Wealth Index research document'],
        suggested_questions=["I'm young and healthy — why do I need an HSA?", 'Why should I care about an HSA?', 'I never go to the doctor. Should I get an HSA?', "What's in it for me as a young person?", "Is an HSA worth it if I don't have many medical expenses?", "I'm just starting out — is an HSA for me?"],
        next_suggested_topics=['qualified_expenses_mental_health', 'triple_tax', 'investment', 'misconceptions'],
    ),
    Topic(
        id="age_65_medicare",
        label='HSA at age 65 & Medicare',
        answer="At age 65, your HSA becomes even more flexible. You can still use it\ntax-free for any qualified medical expense. But you can now also use\nit for non-medical expenses without penalty — you'll just pay ordinary\nincome tax on those withdrawals, the same as a traditional IRA.\n\nOnce you enroll in Medicare, you can no longer make new HSA\ncontributions. But your existing balance remains available. You can\nuse it to pay Medicare premiums for Parts A, B, C (Medicare\nAdvantage), and D (prescription drugs) — as well as copays and\ncoinsurance. The one exception: HSA funds cannot pay for a Medigap\n(Medicare supplement) policy.\n\nIf you delay Medicare past 65 and keep an HSA-qualified health plan,\nyou can keep contributing — including the \$1,000 catch-up\ncontribution — for as long as you remain eligible.\n\nFor married couples where both spouses are 55 or older, each can\nmake their own \$1,000 catch-up contribution. Each spouse must have\ntheir own separate HSA account for this to work.",
        citations=['HealthEquity HSA Guidebook, pp. 77–78', 'WageWorks Guide to HSAs, p. 75'],
        suggested_questions=['What happens to my HSA when I turn 65?', 'Can I use my HSA in retirement?', 'Does Medicare affect my HSA?', 'Can I use my HSA to pay Medicare premiums?', 'What happens to my HSA when I enroll in Medicare?'],
        next_suggested_topics=['retirement_planning', 'portability', 'investment'],
    ),
    Topic(
        id="retirement_planning",
        label='HSA for retirement',
        answer='Retirement healthcare costs are one of the biggest financial risks\nmost people underestimate. According to the Employee Benefit Research\nInstitute (EBRI), a married couple with average prescription drug\nneeds will need approximately \$366,000 to cover out-of-pocket medical\nexpenses in retirement.\n\nAn HSA is uniquely positioned to address this. Unlike a 401(k) or\nIRA, HSA withdrawals for healthcare are never taxed — even in\nretirement. If you invest your HSA contributions throughout your\nworking years, those funds can grow substantially, entirely tax-free.\n\nYoung people just starting their careers have the greatest advantage:\ndecades of tax-free compounding ahead of them. Even modest regular\ncontributions, invested over time, can make a significant difference.\nIt is never too early — or too late — to start.\n\nAfter age 65, HSA funds can also be used penalty-free for non-medical\nexpenses (taxed as ordinary income), giving you a flexible additional\nreserve alongside your 401(k) and Social Security.',
        citations=['HealthEquity HSA Guidebook, pp. 8–9, 118'],
        suggested_questions=['Can I use my HSA for retirement?', 'How does an HSA help with retirement savings?', 'Should I use my HSA as a retirement account?', 'How much will I need for healthcare in retirement?', 'Is an HSA a good long-term savings tool?'],
        next_suggested_topics=['investment', 'age_65_medicare', 'hsa_vs_other'],
    ),
    Topic(
        id="recordkeeping",
        label='Receipts & recordkeeping',
        answer='Treat your HSA records the way you would any financial account —\nsavings, investment, or credit card. Keep documentation showing what\nyou spent and why it was a qualified expense.\n\nAlways save itemized receipts and any Explanation of Benefits (EOB)\nnotices from your health plan. If you paid for a medical expense out\nof pocket and want to reimburse yourself from your HSA later — even\nyears later — those receipts make it possible. There is no IRS\ndeadline on reimbursement, as long as the expense occurred after your\nHSA was opened.\n\nIf the IRS ever questions your HSA withdrawals, your receipts are your\ndefense. Without them, a qualified withdrawal could be treated as\nnon-qualified — triggering income tax plus a 20% penalty.\n\nMost HSA providers have an online portal or app where you can track\ntransactions and store receipts digitally. Build the habit early and\nit takes almost no time.',
        citations=['HSAs For Dummies, Optum Financial Special Edition, p. 20', 'HealthEquity HSA Guidebook, p. 130'],
        suggested_questions=['Do I need to save receipts for my HSA?', 'How do I track my HSA spending?', 'What records do I need to keep for my HSA?', 'Can I get audited on my HSA?', 'How do I reimburse myself from my HSA?'],
        next_suggested_topics=['qualified_expenses', 'contribution_limits'],
    ),
    Topic(
        id="complementary_accounts",
        label='HSA + FSA/HRA together',
        answer='In most cases, having a standard Health FSA or general-purpose HRA\nalongside an HSA will disqualify you from contributing to the HSA.\nHowever, there are HSA-compatible versions designed to work together.\n\nA Limited Purpose FSA (LPFSA) covers only dental and vision expenses.\nBecause it doesn\'t cover general medical expenses, it doesn\'t\ndisqualify your HSA. Using both lets you pay predictable dental and\nvision costs from the LPFSA (with its "use it or lose it" FSA funds)\nwhile keeping your HSA balance invested and growing for everything\nelse.\n\nA Post-Deductible HRA is also compatible — it only reimburses medical\nexpenses after you\'ve met your HDHP\'s minimum deductible, so it\ndoesn\'t interfere with HSA eligibility.\n\nThe strategic advantage: pairing an LPFSA with a maxed-out HSA lets\nyou protect more of your HSA balance for long-term investment, since\ndental and vision costs are covered elsewhere.',
        citations=['WageWorks Guide to HSAs, p. 39', 'HealthEquity HSA Guidebook, pp. 53–54'],
        suggested_questions=['Can I have both an HSA and an FSA?', 'What is a limited purpose FSA?', 'Can my employer give me an HRA if I have an HSA?', 'What is an HSA-compatible FSA?', 'How do I pair my HSA with other benefits?'],
        next_suggested_topics=['hsa_vs_other', 'qualified_expenses_dental_vision', 'funding_strategy'],
    ),
    Topic(
        id="misconceptions",
        label='Common HSA myths',
        answer='HSAs have a reputation for being complicated — but that reputation is\nmostly undeserved. As one guide puts it: "If you can open a savings\naccount, you can handle an HSA."\n\nMyth 1: "It\'s use-it-or-lose-it." False. HSA funds roll over\nindefinitely. There is no deadline to spend the money.\n\nMyth 2: "It\'s only for sick people or big expenses." False. HSAs\ncover everyday costs like prescriptions, OTC medications, therapy,\ndental, and vision — things most people already pay for.\n\nMyth 3: "It\'s the same as an FSA." No. FSAs do have a use-it-or-\nlose-it rule. HSAs are permanent, portable accounts that you own.\n\nMyth 4: "I can\'t invest my HSA." False. Most HSAs let you invest in\nmutual funds, stocks, and more — and those earnings are entirely\ntax-free.\n\nMyth 5: "My employer controls it." False. You own your HSA. Your\nemployer can contribute to it but has no control over how you use it.\n\nDespite these facts, 66% of HSA holders do not know how their funds\nare invested, and over 80% of lower-literacy holders don\'t know if\ntheir balance is in cash or market assets. Knowing even the basics\nputs you ahead of the majority of account holders.',
        citations=['HSAs For Dummies, Optum Financial Special Edition, Introduction, p. 1', 'WageWorks Guide to HSAs, p. 75', 'Behavioral Architecture of Financial Avoidance research document'],
        suggested_questions=['Is an HSA complicated?', "I've heard HSAs are confusing — is that true?", 'What do people get wrong about HSAs?', 'Are there myths about HSAs I should know?', 'I thought I had to spend my HSA money every year'],
        next_suggested_topics=['what_is_hsa', 'young_adults', 'triple_tax'],
    ),
    Topic(
        id="non_qualified_withdrawals",
        label='What if I spend it wrong?',
        answer='If you use HSA funds for a non-qualified expense before age 65, you\nwill owe ordinary income tax on that amount plus a 20% penalty. That\nis steep — so knowing what qualifies matters.\n\nAfter age 65, the 20% penalty disappears. You can use HSA funds for\nany purpose — but non-medical withdrawals are still subject to\nordinary income tax, just like a traditional 401(k).\n\nIf you accidentally use your HSA for a non-qualified expense, some\nHSA administrators will allow you to return the funds before the tax\nfiling deadline without penalty — check with your specific provider.\n\nYou cannot deduct an expense on your taxes and also use HSA funds for\nthe same expense. "Double-dipping" is not permitted by the IRS.',
        citations=['HealthEquity HSA Guidebook, p. 101', 'WageWorks Guide to HSAs, p. 75'],
        suggested_questions=['What happens if I use my HSA for non-medical expenses?', 'What is the penalty for misusing my HSA?', 'Can I withdraw HSA money for anything I want?', "What if I accidentally spend HSA money on something that doesn't qualify?", 'Is there a penalty for wrong HSA withdrawals?'],
        next_suggested_topics=['qualified_expenses', 'age_65_medicare', 'recordkeeping'],
    ),
    Topic(
        id="opening_an_hsa",
        label='How do I open an HSA?',
        answer='You can open an HSA through several channels depending on your\nsituation.\n\nThrough your employer: Most people enroll during open enrollment\nusing their HR or benefits portal. If your employer offers an HSA-\nqualified health plan, they typically have a preferred HSA provider\nalready set up, and contributions can come directly through payroll\n(with FICA tax savings).\n\nOn your own: You can open an HSA independently at a bank, credit\nunion, or HSA-specific administrator. This is common for self-\nemployed individuals or people on marketplace plans. You contribute\nafter-tax dollars and claim the deduction on your federal tax return.\n\nWhen comparing providers, look at: monthly fees and transaction fees,\ninvestment options and minimum balance requirements, ease of access\n(app, online portal), and whether automated investing is available.\nLower fees compound into meaningfully more money over time.\n\nYour HSA custodian will have you complete a trust or custodial\nagreement (IRS Form 5305-B or 5305-C). Most providers allow this\nentirely online.',
        citations=['HealthEquity HSA Guidebook, pp. 62–66'],
        suggested_questions=['How do I open an HSA?', 'Where can I get an HSA?', 'How do I start an HSA?', 'Can I open an HSA on my own?', 'Do I open my HSA through my employer?'],
        next_suggested_topics=['eligibility', 'contribution_limits', 'funding_strategy'],
    ),
    # Scenario-based welcome topics (suggested on HSA Topics page)
    Topic(
        id="understanding_hsa",
        label='What is an HSA?',
        answer='An HSA (Health Savings Account) is a tax-advantaged savings account for\nqualified medical expenses. You must be enrolled in a high-deductible\nhealth plan (HDHP) to contribute. You and your employer can both put\nmoney in; contributions go in tax-free and funds roll over every year with\nno expiration. You can use it for current healthcare costs or save for\nfuture medical needs.',
        citations=['HealthEquity HSA Guidebook, p. 25', 'WageWorks Guide to HSAs, p. 8'],
        suggested_questions=['What is an HSA?', 'Explain HSAs', 'Understanding Health Savings Accounts'],
        next_suggested_topics=['hsa_awareness_basic', 'confusion_eligibility'],
    ),
    Topic(
        id="contribute_decisions",
        label='Should I Put Money Into an HSA?',
        answer='Introduction on whether to contribute to an HSA. Your situation — employer\nmatch, debt, cash flow — affects the answer. Choose a topic below to explore\nbenefits and trade-offs, whether an HSA is worth it for you, or how much to contribute.',
        citations=['HealthEquity HSA Guidebook, pp. 38, 49, 118–119'],
        suggested_questions=['Should I contribute to an HSA?', 'How much should I put in my HSA?', 'Decisions about HSA contributions'],
        next_suggested_topics=['whether_to_contribute', 'is_hsa_worth_it', 'how_much_to_contribute'],
    ),
    Topic(
        id="using_hsa",
        label='How to Use Your HSA',
        answer='You can use your HSA to pay for qualified medical expenses — with your\nHSA card at the point of care or by reimbursing yourself after paying\nout of pocket. You can also use it for your spouse and tax dependents.\nChoose a topic below to go deeper.',
        citations=['HealthEquity HSA Guidebook, p. 183', 'WageWorks Guide to HSAs, p. 67'],
        suggested_questions=['How do I use my HSA?', 'What can I pay for with my HSA?', 'Using the HSA for expenses'],
        next_suggested_topics=['what_expenses_qualify', 'saving_vs_spending_hsa'],
    ),
    Topic(
        id="long_term_planning",
        label='Long-Term HSA Strategy',
        answer='Introduction to saving for future medical costs. An HSA can help you\nprepare for rising healthcare expenses and retirement. Choose a topic below to\nexplore long-term value or investing your HSA funds.',
        citations=['HealthEquity HSA Guidebook, pp. 8–9, 77–78, 118'],
        suggested_questions=['HSA for retirement?', 'Long-term healthcare planning with HSA', 'Healthcare in retirement'],
        next_suggested_topics=['long_term_value_hsa', 'investing_hsa_funds'],
    ),
    Topic(
        id="emotional_support",
        label='Smart Healthcare Money Decisions',
        answer='**Smart Healthcare Money Decisions**\n\nMany people struggle to manage healthcare and money together — from understanding\nplan options to saving for future costs. Research shows a large share of adults\nfind it hard to make confident decisions about HSAs and healthcare spending.\nChoose a topic below to address uncertainty or feeling overwhelmed by options.',
        citations=['Generational HSA Divide research document', 'Behavioral Architecture of Financial Avoidance research document'],
        suggested_questions=['I\'m unsure about getting an HSA', 'Emotional support for HSA decisions', 'Is an HSA right for me?'],
        next_suggested_topics=['uncertainty_hsa', 'overwhelmed_by_options'],
    ),
    Topic(
        id="tradeoff_support",
        label='Is an HSA Worth It for Me?',
        answer='When comparing options, the HSA is the only U.S. account that combines\nall three tax benefits: tax-free contributions, tax-free growth, and\ntax-free withdrawals for qualified expenses. No 401(k), IRA, or FSA\noffers all three.\n\nHSA vs 401(k): HSA payroll contributions skip FICA taxes; 401(k)\nwithdrawals are taxed in retirement — HSA withdrawals for medical expenses\nare not. HSA vs FSA: FSA has use-it-or-lose-it; HSA funds roll over\nindefinitely. If you can afford to pay current medical costs out of\npocket, maxing your HSA and investing the balance is one of the most\npowerful moves available.',
        citations=['HealthEquity HSA Guidebook, pp. 5–6, 29', 'WageWorks Guide to HSAs, p. 15'],
        suggested_questions=['HSA vs 401k?', 'HSA or FSA?', 'Tradeoffs of choosing an HSA'],
        next_suggested_topics=['hsa_vs_other', 'triple_tax', 'funding_strategy'],
    ),
    Topic(
        id="behavioral_nudges",
        label='Behavioral Nudges and Education',
        answer='**Encouraging Active & Smart HSA Use**\n\nSmall steps and gentle nudges can help you get more from your HSA. Choose the\npath below that fits you: rarely think about your HSA, or you contribute but\nwant to understand how it helps.',
        citations=['Generational HSA Divide research document', 'Behavioral Architecture of Financial Avoidance research document', 'HealthEquity HSA Guidebook, pp. 118–119'],
        suggested_questions=['How do I get started with an HSA?', 'Tips for using my HSA better', 'Behavioral nudges for HSA'],
        next_suggested_topics=['hsa_rarely_think', 'contribute_dont_understand'],
    ),
    # Follow-up choices after "Tips to Save and Use Your HSA Wisely"
    Topic(
        id="hsa_rarely_think",
        label='I have an HSA but I rarely think about it.',
        answer="**1. Gentle reminders**\n\n- (a) Monthly check-in: a quick notification to look at your HSA.\n- (b) Prompt: \"You haven't used your HSA this month\" — not to pressure you, but to surface it so you can use it for a qualified expense or simply check your balance.\n\n**2. Periodic check-ins**\n\n- (a) Quick quarterly review: set a reminder every few months to log in and see your balance and contribution rate.\n- (b) Example prompt: \"Want a 60-second HSA balance check?\" — one small step to stay aware.\n\n**3. Highlight benefits of active use**\n\n- (a) Remind yourself of the triple tax advantage: money in tax-free, grows tax-free, comes out tax-free for medical expenses.\n- (b) Show potential long-term impact: e.g. contributing \$100/month for 20 years can grow to a substantial sum if invested, all available for healthcare.\n\n**4. Micro-action prompts**\n\n- (a) \"Set \$20 auto-contribution?\" — a small automatic amount builds the habit without much effort.\n- (b) \"Save receipt now?\" — when you pay a medical bill, snap and store the receipt so you can reimburse yourself later and let the HSA keep growing.",
        citations=['Behavioral Architecture of Financial Avoidance research document', 'HealthEquity HSA Guidebook, pp. 118–119'],
        suggested_questions=['I forget about my HSA', 'Rarely use my HSA', 'HSA reminders'],
        next_suggested_topics=[
            "understanding_hsa", "contribute_decisions", "using_hsa",
            "long_term_planning", "emotional_support", "behavioral_nudges",
        ],
    ),
    Topic(
        id="contribute_dont_understand",
        label="I contribute, but I don't really understand how it helps.",
        answer="**1. Break benefits into simple visuals**\n\n- Tax savings example: e.g. \"A \$1,000 HSA contribution might only cost you ~\$700 after tax savings (depending on your bracket).\"\n- Future value projection: e.g. contributing \$3,000/year for 25 years at 5% growth could grow to over \$140,000 for future healthcare.\n\n**2. Mini education moments**\n\n- 1-sentence tip cards you can revisit: \"Contributions are tax-free in, growth is tax-free, withdrawals for medical expenses are tax-free.\"\n- \"Did you know? HSAs never expire — your balance rolls over every year.\"\n\n**3. Behavioral framing**\n\n- *Loss aversion:* Your annual contribution limit resets each year — unused contribution space doesn't carry over. So using this year's \"space\" is an opportunity.\n- *Future-self framing:* \"This could cover retirement medical costs\" — the money you put in now can compound for decades and pay for healthcare when you're older.\n\n**4. Small optimization tips**\n\n- \"Increase by \$10/month?\" — a small bump (e.g. \$10 more per month) adds up and often goes unnoticed in your budget.\n- \"Invest after \$1,000 balance?\" — many providers let you invest once your cash balance reaches \$1,000; the rest can grow in the market for long-term healthcare savings.",
        citations=['HealthEquity HSA Guidebook, pp. 66, 118–119, 127–129', 'WageWorks Guide to HSAs, p. 64'],
        suggested_questions=["Don't understand HSA benefits", 'How does my HSA help?', 'HSA education'],
        next_suggested_topics=[
            "understanding_hsa", "contribute_decisions", "using_hsa",
            "long_term_planning", "emotional_support", "behavioral_nudges",
        ],
    ),
    # Follow-up choices after "Smart Healthcare Money Decisions"
    Topic(
        id="uncertainty_hsa",
        label='Uncertainty of HSA',
        answer="**Normalize uncertainty**\n\nIt's normal to feel unsure about HSAs. Many people do — only a small share of\nadults can correctly explain all three tax benefits. Feeling uncertain doesn't\nmean you're behind; it means you're paying attention.\n\n**Structured decision guide**\n\nA simple way to decide: (1) Check if you're eligible (HDHP, no disqualifying\ncoverage). (2) See if your employer offers a match — if yes, contribute at least\nenough to get it. (3) Decide how much more you can save based on your budget.\n\n- *Real-world examples:*\n  - Employer match \$600/year → contribute \$50/month (\$600/year) to capture it.\n  - Income ~\$50,000, no match → start with \$75/paycheck (biweekly) ≈ \$1,950/year.\n  - Family coverage, match \$1,000 → contribute \$84/month to get the match; add more if budget allows.\n  - Part-time: \$25/paycheck ≈ \$650/year still builds tax-advantaged savings.\n\n**Reinforce flexibility**\n\nYou can change your contribution amount anytime. HSA funds never expire. If your\nsituation changes — new job, different plan, tight month — you can adjust.\nThere's no single \"right\" path.\n\n**Suggest starting small**\n\nYou don't need to max out your HSA to benefit. Even small, consistent\ncontributions add up and reduce your tax bill. *Example:* Someone earning \$45,000\nmight start with \$25 or \$50 per paycheck; that's \$600–\$1,200 per year in\ntax-advantaged savings and builds the habit without straining the budget.",
        citations=['Generational HSA Divide research document', 'Behavioral Architecture of Financial Avoidance research document'],
        suggested_questions=['Uncertain about HSA', 'HSA uncertainty', 'Not sure about HSA'],
        next_suggested_topics=[
            "understanding_hsa", "contribute_decisions", "using_hsa",
            "long_term_planning", "emotional_support", "behavioral_nudges",
        ],
    ),
    Topic(
        id="overwhelmed_by_options",
        label='Feeling Overwhelmed by Options',
        answer="**Break HSA into simple steps**\n\nInstead of tackling everything at once, focus on one step: (1) Confirm you're\neligible. (2) Open or link your HSA. (3) Set a first contribution amount.\n(4) Later, look at investing if your balance and comfort allow. You can pause\nbetween steps.\n\n**Prioritized checklist**\n\n1. Get the employer match if you have one — free money.\n2. Build a small emergency buffer so you're not stressed about every dollar.\n3. Contribute something consistent to your HSA, even if it's small.\n4. Keep receipts for medical expenses.\n5. When ready, consider investing the balance above your cash cushion.\n\n**Ongoing support**\n\nYou can come back to this anytime. Revisit your contribution at open enrollment\nor when your income or expenses change. There's no deadline to \"figure it all\nout\" — small, steady progress is enough.",
        citations=['HealthEquity HSA Guidebook, pp. 49, 118–119', 'Behavioral Architecture of Financial Avoidance research document'],
        suggested_questions=['Overwhelmed by HSA options', 'Too many choices', 'HSA steps'],
        next_suggested_topics=[
            "understanding_hsa", "contribute_decisions", "using_hsa",
            "long_term_planning", "emotional_support", "behavioral_nudges",
        ],
    ),
    # Follow-up choices after "Should I Put Money Into an HSA?"
    Topic(
        id="whether_to_contribute",
        label='Benefits to Contribute / Trade-Offs',
        answer="**1. Benefit of employer HSA matching**\n\nIf your employer contributes to your HSA or matches your contributions,\nthat's free additional savings — you don't pay taxes on it, and it goes\ndirectly into your account. Many employers offer a set amount or a\nmatch when you contribute. Contributing at least enough to get the full\nemployer match is one of the best moves you can make; otherwise you're\nleaving money on the table.\n\n**2. HSA contributions vs. paying student loan interest**\n\nHSA contributions reduce your taxable income and can save you 22–30%\n(or more) in combined federal, state, and FICA taxes, depending on your\nbracket. So a \\$1,000 HSA contribution might only cost you around\n\$650–700 after tax savings. Paying student loan interest reduces the\namount of interest you pay over time and can qualify for a tax deduction\n(up to \\\$2,500) in some cases, but it doesn't give you the triple tax\nadvantage or the flexibility of an HSA for future healthcare.\n\n**3. A simple, balanced recommendation**\n\nGet the employer HSA match first — that's free money. Then evaluate your\nstudent loan situation. If you have high-interest debt, paying it down\nmay feel urgent; if your employer match is strong and your loan rate is\nmoderate, contributing to your HSA still builds tax-free healthcare\nsavings that never expire. There's no single right answer for everyone —\nit depends on your match, your loan rate, and your cash flow.\n\n**4. Reassurance**\n\nBoth saving in an HSA and repaying debt are valid financial priorities.\nYou don't have to choose one and ignore the other. Even small HSA\ncontributions add up and reduce your tax bill; even extra loan payments\nreduce interest over time. Doing a little of both is often reasonable.",
        citations=['HealthEquity HSA Guidebook, pp. 49, 118–119', 'HSA Chatbot Knowledge Base & Fact Sheet'],
        suggested_questions=['Whether to contribute', 'Should I contribute or pay loans?', 'HSA vs student loans'],
        next_suggested_topics=[
            "understanding_hsa", "contribute_decisions", "using_hsa",
            "long_term_planning", "emotional_support", "behavioral_nudges",
        ],
    ),
    Topic(
        id="is_hsa_worth_it",
        label='Is HSA Worth it for me?',
        answer="**1. Prioritize financial stability when savings are limited**\n\nWhen money is tight, focus on stability first. An HSA is valuable, but it works\nbest when you have some flexibility. If you're building from zero, that's okay —\nmany people start small.\n\n**2. Emergency funds provide flexibility**\n\nAn emergency fund covers unexpected non-medical expenses (car repair, job loss,\netc.). HSA funds are for qualified medical expenses. Having a small cash buffer\nmeans you're not forced to tap the HSA for non-medical emergencies or stress\nabout every dollar.\n\n**3. HSA benefits (without repeating definitions)**\n\nHSAs offer tax advantages and future healthcare savings — contributions go in\ntax-free, growth is tax-free, and withdrawals for medical expenses are tax-free.\nThey're especially powerful when you can invest the balance for the long term.\n\n**4. A simple priority framework**\n\n(a) Build a small emergency buffer first (e.g. a starter savings fund).\n(b) Contribute to your HSA if there's an employer match — that's free money.\n(c) Increase HSA savings once your financial situation feels more stable.\n\n*Example:* Aim for \$500–\$1,000 in a starter emergency fund, then contribute\nenough to your HSA to get the full employer match (e.g. if they match up to\n\$600/year, contribute at least \$600). Once you have one to two months of\nexpenses saved, you can gradually increase HSA contributions.\n\n**5. Trade-off: liquidity vs. long-term tax benefits**\n\nEmergency savings are liquid; you can use them for anything. HSA money is best\nused for medical expenses to keep the tax benefit. Both matter — it's about\nfinding a balance that fits your life right now.\n\n**6. Balanced guidance, not a strict rule**\n\nThere's no single right order for everyone. Your age, health, job security, and\ndebt all play a role. The framework above is a starting point, not a requirement.\n\n**7. Reassurance**\n\nIt's normal to feel uncertain. Many people wonder if they're doing enough.\nMaking any progress — whether a small emergency fund or a first HSA contribution —\nis moving in the right direction.",
        citations=['HealthEquity HSA Guidebook, pp. 49, 118–119', 'Generational HSA Divide research document'],
        suggested_questions=['Is an HSA worth it for me?', 'Should I get an HSA?', 'HSA vs emergency fund'],
        next_suggested_topics=[
            "understanding_hsa", "contribute_decisions", "using_hsa",
            "long_term_planning", "emotional_support", "behavioral_nudges",
        ],
    ),
    Topic(
        id="how_much_to_contribute",
        label='How Much to Contribute',
        answer="**1. Annual HSA contribution limits**\n\nThe IRS sets a maximum you can put into your HSA each year — from all\nsources combined (you, your employer, anyone). For 2025: self-only\ncoverage is \$4,300; family coverage is \$8,750. If you're 55 or older, you\ncan add an extra $1,000 catch-up contribution. These limits adjust each\nyear for inflation. If you exceed the limit, you may owe a 6% excise tax\non the excess, so it's important to stay within the cap.\n\n**2. General contribution guidance**\n\nStart small if you need to — even \$25 or $50 per paycheck adds up and\ngives you tax savings. Increase gradually as your budget allows. There's\nno minimum; the key is to contribute something consistent so you build\nthe habit and the balance.\n\n**3. Typical strategies**\n\nMany people first contribute enough to cover their expected medical\ncosts for the year (copays, prescriptions, dental, vision). That way\nyour HSA is there when you need it. After that, consider saving extra\nfor the future — either for a health emergency or for retirement\nhealthcare. If you can afford to pay current medical bills out of pocket\nand leave your HSA invested, that can maximize long-term growth.\n\n**4. Flexibility**\n\nYou can change your contribution amount anytime. If your employer allows\nit, you can adjust payroll deductions during the year; if you contribute\non your own, you control the timing and amount. There's no commitment —\ncontribute what makes sense now and revisit as your situation changes.",
        citations=['HealthEquity HSA Guidebook, pp. 38, 118–119', 'HSAs For Dummies, Optum Financial Special Edition, p. 13'],
        suggested_questions=['How much to contribute', 'HSA contribution limits', 'How much should I put in my HSA?'],
        next_suggested_topics=[
            "understanding_hsa", "contribute_decisions", "using_hsa",
            "long_term_planning", "emotional_support", "behavioral_nudges",
        ],
    ),
    # Follow-up choices after "What is an HSA?"
    Topic(
        id="hsa_awareness_basic",
        label='HSA Awareness & Basic Understanding',
        answer="**How it works:** Contributions go in tax-free (from you or your employer),\nfunds roll over every year with no expiration, and withdrawals for qualified\nmedical expenses are tax-free. Many people invest their HSA balance for\nlong-term growth. You own the account — it stays with you when you change\njobs or health plans.\n\n**Who typically qualifies:** You must be in an HSA-qualified high-deductible\nhealth plan (HDHP). You cannot have a general-purpose FSA, be on Medicare,\nor be claimed as someone else's dependent. Employer plans and ACA\nmarketplace plans (e.g. bronze, catastrophic) often qualify — check with\nHR or your insurer.\n\n**Examples of use:** People pay for doctor visits, prescriptions, dental\ncleanings, vision exams, mental health therapy, and over-the-counter\nmedications. Some pay current bills with their HSA card; others pay out\nof pocket and reimburse later so the balance stays invested. Many use it\nfor both short-term costs (a copay today) and future needs (retirement\nhealthcare).",
        citations=['HealthEquity HSA Guidebook, pp. 6–7, 25, 183', 'WageWorks Guide to HSAs, pp. 8, 15, 67', 'Generational HSA Divide research document'],
        suggested_questions=['HSA awareness', 'Basic understanding of HSA', 'Who uses HSAs?'],
        next_suggested_topics=[
            "understanding_hsa", "contribute_decisions", "using_hsa",
            "long_term_planning", "emotional_support", "behavioral_nudges",
        ],
    ),
    Topic(
        id="confusion_eligibility",
        label='Confusion About Eligibility',
        answer="**Eligibility by situation**\n\n**HDHP (High-Deductible Health Plan):** You must be in an HSA-qualified\nhealth plan. The IRS sets minimum deductibles and maximum out-of-pocket\nlimits each year (e.g. 2025: \$1,650 single / \$3,300 family deductible;\n\$8,300 / \$16,600 out-of-pocket max). Your plan must meet these. You\ncannot have a standard Health FSA, be on Medicare, or be claimed as a\ndependent on someone else's return. Other coverage (e.g. a spouse's plan\nthat pays before your deductible) can disqualify you — check with HR or\nyour plan.\n\n**Employer:** If your employer offers an HSA-qualified HDHP, you usually\nenroll during open enrollment. Contributions can come through payroll\n(with FICA savings). You cannot contribute to an HSA if you also have a\ngeneral-purpose FSA or HRA that pays before the HDHP deductible. A\nLimited Purpose FSA (dental/vision only) or a post-deductible HRA is\nallowed.\n\n**Student / parent's plan:** If you're on a parent's plan, you can only\nopen and contribute to an HSA if that plan is HSA-qualified. Many\nparent plans are not. If you're claimed as a dependent, you generally\ncannot contribute. Once you're no longer a dependent (e.g. after 26 or\nwhen you have your own HDHP), you can open an HSA if your current plan\nqualifies. Student health plans vary — confirm with the school or\ninsurer whether the plan meets HDHP rules.\n\n**Possible next steps**\n\n- **Check your plan:** Ask HR or your insurer: \"Is my plan HSA-qualified?\"\n  They can confirm deductible and out-of-pocket limits.\n- **If you have an HDHP:** You can open an HSA (through work or on your\n  own), then contribute up to the annual limit.\n- **If you're on a parent's or student plan:** Get the plan document or\n  summary; look for \"HSA-eligible\" or ask the provider. If it's not\n  HSA-eligible, you'd need to switch to an HSA-qualified plan (e.g. at\n  a new job or on the marketplace) to contribute.\n- **If you have an FSA:** A general-purpose FSA blocks HSA contributions.\n  A Limited Purpose FSA does not — you can have both.",
        citations=['HealthEquity HSA Guidebook, pp. 6–8', 'WageWorks Guide to HSAs, p. 8', 'WageWorks Guide to HSAs, p. 39'],
        suggested_questions=['Am I eligible?', 'Confusion about eligibility', 'Can I get an HSA on my plan?'],
        next_suggested_topics=[
            "understanding_hsa", "contribute_decisions", "using_hsa",
            "long_term_planning", "emotional_support", "behavioral_nudges",
        ],
    ),
    # Follow-up choices after "How to Use Your HSA?"
    Topic(
        id="what_expenses_qualify",
        label='What Expenses Qualify',
        answer="**Examples of qualified expenses:** Doctor and specialist visits, hospital\nstays, prescriptions, dental (cleanings, fillings, braces), vision (exams,\nglasses, contacts, LASIK), mental health therapy, over-the-counter\nmedications and many OTC items (e.g. bandages, menstrual products), and\npreventive care. You can use HSA funds for your spouse and tax dependents\ntoo.\n\n**Documentation requirements:** Keep itemized receipts and Explanation of\nBenefits (EOB) notices. If you reimburse yourself later — even years\nlater — you need proof the expense was qualified and occurred after your\nHSA was opened. Your HSA provider's app or portal can help you store\nreceipts.\n\n**IRS-approved categories:** The IRS defines qualified medical expenses in\nPublication 502 (Medical and Dental Expenses). Common categories include\nmedical care, prescription drugs, dental and vision, and certain insurance\npremiums (e.g. COBRA, Medicare after 65). When in doubt, check Publication\n502 or ask your tax advisor.\n\n**Record-keeping:** Treat your HSA like any financial account. Without\nreceipts, the IRS could treat a withdrawal as non-qualified (income tax plus\n20% penalty before age 65). Build the habit early; it takes little time\nwith a digital folder or your provider's tool.",
        citations=['HealthEquity HSA Guidebook, p. 183', 'WageWorks Guide to HSAs, p. 67', 'HSAs For Dummies, Optum Financial Special Edition, p. 20', 'IRS Publication 502'],
        suggested_questions=['What expenses qualify?', 'What can I use my HSA for?', 'Qualified medical expenses'],
        next_suggested_topics=[
            "understanding_hsa", "contribute_decisions", "using_hsa",
            "long_term_planning", "emotional_support", "behavioral_nudges",
        ],
    ),
    Topic(
        id="saving_vs_spending_hsa",
        label='Saving vs. Spending HSA Funds',
        answer="**1. Explain the two strategies clearly**\n\n- (a) **Strategy A: Use HSA now to cover expenses** — Pay for qualified medical\n  costs (copays, prescriptions, dental, etc.) directly from your HSA so you\n  don't dip into regular savings. You get immediate tax-free use of the money.\n- (b) **Strategy B: Pay out-of-pocket and let HSA grow** — Pay medical bills\n  from your regular account, keep receipts, and leave your HSA balance invested.\n  You can reimburse yourself years later; in the meantime the balance compounds tax-free.\n\n**2. Show a simple comparison**\n\n- (a) **Spend now** → immediate tax-free savings; you use the HSA like a healthcare\n  checking account and free up cash flow.\n- (b) **Save & invest** → potential compounding growth; money stays in the account,\n  can be invested, and may grow substantially for future or retirement healthcare.\n\n*Number example* (a \$500 medical bill):\n- **Spend now:** Use \$500 from your HSA — you save ~\$110–150 in taxes (vs. paying with after-tax dollars in a 22–30% bracket).\n- **Save & invest:** Pay \$500 out of pocket, leave \$500 in the HSA invested; at 6% growth for 20 years that \$500 could become ~\$1,600 tax-free for future healthcare.\n\n**3. When each makes sense**\n\n- (a) **Use now if:** tight cash flow, need to cover current medical costs without\n  stress, or prefer simplicity (pay and move on).\n- (b) **Save if:** stable finances, long-term mindset, and you can afford to pay\n  medical bills from other funds so the HSA can grow.\n\n**4. Reinforce flexibility**\n\n- (a) You can reimburse yourself later — there's no IRS deadline. Pay out of\n  pocket today, keep the receipt, and take money from the HSA in a future year.\n- (b) No expiration on funds. HSA money rolls over every year; you can mix\n  strategies (use some now, let the rest grow) and change approach as your situation changes.",
        citations=['HealthEquity HSA Guidebook, pp. 66, 118–119, 127–129', 'WageWorks Guide to HSAs, p. 64'],
        suggested_questions=['Save or spend HSA?', 'Should I use my HSA now or later?', 'Saving vs spending HSA funds'],
        next_suggested_topics=[
            "understanding_hsa", "contribute_decisions", "using_hsa",
            "long_term_planning", "emotional_support", "behavioral_nudges",
        ],
    ),
    # Follow-up choices after "Long-Term HSA Strategy"
    Topic(
        id="long_term_value_hsa",
        label='Long-Term Value of HSA',
        answer="**Rising healthcare costs**\n\nHealthcare costs tend to rise over time, and retirement medical expenses are\none of the biggest financial risks people underestimate. A married couple with\naverage prescription needs may need hundreds of thousands of dollars for\nout-of-pocket medical expenses in retirement.\n\n**HSA as a future safety net**\n\nAn HSA is uniquely positioned for this: you contribute during your working\nyears, the money grows tax-free, and withdrawals for qualified healthcare are\nnever taxed — even in retirement. After 65 you can also use it for\nnon-medical expenses (taxed like an IRA) or for Medicare premiums.\n\n**Simple projection example**\n\nSaving a few thousand per year in an HSA and investing it over decades can\ngrow into a substantial sum. For example, contributing and investing over 20–30\nyears can build a six-figure balance for retirement healthcare, depending on\namounts and returns.\n\n**Planning steps**\n\n1. Contribute consistently, especially if you have an employer match.\n2. Consider investing your HSA balance once you have a comfortable cash\n   cushion for near-term medical needs.\n3. Keep receipts so you can reimburse yourself later and let the balance grow.\n4. Revisit your strategy as you approach retirement and Medicare.",
        citations=['HealthEquity HSA Guidebook, pp. 8–9, 118', 'Employee Benefit Research Institute (EBRI)'],
        suggested_questions=['Long-term value of HSA', 'HSA for future healthcare', 'Retirement HSA'],
        next_suggested_topics=[
            "understanding_hsa", "contribute_decisions", "using_hsa",
            "long_term_planning", "emotional_support", "behavioral_nudges",
        ],
    ),
    Topic(
        id="investing_hsa_funds",
        label='Investing HSA Funds',
        answer="**Investment feature, simply put**\n\nMany HSA providers let you invest your balance in stocks, bonds, and mutual\nfunds once your cash balance reaches a minimum (often \$1,000–\$2,000). Any\namount above that can be moved into investments. Earnings grow tax-free as long\nas you use the money for qualified medical expenses.\n\n**Risks vs. benefits**\n\nInvestments can go up or down — they're not FDIC-insured like cash. The benefit\nis long-term growth: over decades, invested HSA funds can grow substantially,\nall tax-free for healthcare. Many people who can afford to pay current medical\nbills out of pocket leave their HSA invested to maximize growth.\n\n**Beginner-friendly advice**\n\nStart by keeping enough in cash to cover expected medical costs for the year.\nThen consider moving the rest into a diversified option (e.g. a target-date or\nindex fund) if your provider offers it. You can move money back to cash anytime\nif you need it for an expense.\n\n**Gradual approach**\n\nYou don't have to invest everything at once. Build the habit of contributing\nfirst; then, as your balance grows and you're comfortable with the rules, consider\ninvesting a portion. Only 9–15% of HSA holders invest — those who do often\nbenefit from years of tax-free compounding.",
        citations=['HealthEquity HSA Guidebook, pp. 66, 127–129', 'WageWorks Guide to HSAs, p. 64', 'Behavioral Architecture of Financial Avoidance research document'],
        suggested_questions=['Invest HSA?', 'Investing HSA funds', 'HSA investment options'],
        next_suggested_topics=[
            "understanding_hsa", "contribute_decisions", "using_hsa",
            "long_term_planning", "emotional_support", "behavioral_nudges",
        ],
    ),
]

DEFAULT_WELCOME_TOPIC_IDS = [
    "understanding_hsa",
    "contribute_decisions",
    "using_hsa",
    "long_term_planning",
    "emotional_support",
    "behavioral_nudges",
]

# Topic difficulty / pacing tags (visual only — reduces overwhelm, signals natural order).
# 🟢 Good starting point | 🟡 A little more detail | 🔵 When you're ready
TOPIC_DIFFICULTY: dict[str, dict[str, str]] = {
    "what_is_hsa": {"emoji": "🟢", "label": "Good starting point"},
    "portability": {"emoji": "🟢", "label": "Good starting point"},
    "misconceptions": {"emoji": "🟢", "label": "Good starting point"},
    "understanding_hsa": {"emoji": "🟢", "label": "Good starting point"},
    "hsa_awareness_basic": {"emoji": "🟢", "label": "Good starting point"},
    "confusion_eligibility": {"emoji": "🟢", "label": "Good starting point"},
    "emotional_support": {"emoji": "🟢", "label": "Good starting point"},
    "uncertainty_hsa": {"emoji": "🟢", "label": "Good starting point"},
    "overwhelmed_by_options": {"emoji": "🟢", "label": "Good starting point"},
    "hsa_rarely_think": {"emoji": "🟢", "label": "Good starting point"},
    "contribute_dont_understand": {"emoji": "🟢", "label": "Good starting point"},
    "behavioral_nudges": {"emoji": "🟢", "label": "Good starting point"},
    "triple_tax": {"emoji": "🟡", "label": "A little more detail"},
    "qualified_expenses": {"emoji": "🟡", "label": "A little more detail"},
    "contribution_limits": {"emoji": "🟡", "label": "A little more detail"},
    "contribute_decisions": {"emoji": "🟡", "label": "A little more detail"},
    "whether_to_contribute": {"emoji": "🟡", "label": "A little more detail"},
    "is_hsa_worth_it": {"emoji": "🟡", "label": "A little more detail"},
    "how_much_to_contribute": {"emoji": "🟡", "label": "A little more detail"},
    "using_hsa": {"emoji": "🟡", "label": "A little more detail"},
    "what_expenses_qualify": {"emoji": "🟡", "label": "A little more detail"},
    "saving_vs_spending_hsa": {"emoji": "🟡", "label": "A little more detail"},
    "tradeoff_support": {"emoji": "🟡", "label": "A little more detail"},
    "investment": {"emoji": "🔵", "label": "When you're ready"},
    "retirement_planning": {"emoji": "🔵", "label": "When you're ready"},
    "complementary_accounts": {"emoji": "🔵", "label": "When you're ready"},
    "long_term_planning": {"emoji": "🔵", "label": "When you're ready"},
    "long_term_value_hsa": {"emoji": "🔵", "label": "When you're ready"},
    "investing_hsa_funds": {"emoji": "🔵", "label": "When you're ready"},
}


def get_topic_difficulty(topic_id: str) -> Optional[dict[str, str]]:
    """Return {emoji, label} for a topic's difficulty tag, or None if untagged."""
    return TOPIC_DIFFICULTY.get(topic_id)


def get_topics_by_difficulty_filter(filter_label: Optional[str]) -> list["Topic"]:
    """Return topics. If filter_label is None or 'All', return all; else only topics with that difficulty label."""
    if not filter_label or filter_label == "All":
        return list(TOPICS)
    return [t for t in TOPICS if get_topic_difficulty(t.id) and get_topic_difficulty(t.id)["label"] == filter_label]


QUALIFIED_EXPENSES_SUB_TOPIC_IDS = [
    "qualified_expenses_mental_health",
    "qualified_expenses_dental_vision",
    "qualified_expenses_otc",
    "qualified_expenses_premiums",
    "qualified_expenses_family",
]
SUGGESTED_TOPIC_LABELS = [t.label for t in TOPICS]

def get_topic_by_id(topic_id: str) -> Optional[Topic]:
    for t in TOPICS:
        if t.id == topic_id:
            return t
    return None

def get_topic_by_label(label: str) -> Optional[Topic]:
    label_clean = label.strip()
    for t in TOPICS:
        if t.label.strip() == label_clean:
            return t
    return None

def get_topic_by_suggested_question(user_message: str) -> Optional[Topic]:
    msg = user_message.strip().lower()
    if not msg:
        return None
    for t in TOPICS:
        for q in t.suggested_questions:
            if q.strip().lower() == msg:
                return t
            if q.strip().lower() in msg or msg in q.strip().lower():
                return t
    return None

def get_all_topics() -> list[Topic]:
    return list(TOPICS)

def get_welcome_topics() -> list[Topic]:
    return [t for t in TOPICS if t.id in DEFAULT_WELCOME_TOPIC_IDS]


def get_qualified_expenses_sub_topics() -> list[Topic]:
    """Sub-topics to show after the main qualified_expenses answer (hub)."""
    return [t for t in TOPICS if t.id in QUALIFIED_EXPENSES_SUB_TOPIC_IDS]
